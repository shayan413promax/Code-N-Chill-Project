<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Artisan Essentials - Shop</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Cormorant+Garamond:wght@300;400;600&family=Cinzel:wght@400;600;900&display=swap"
        rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Georgia', serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2332 0%, #2d4563 50%, #4a6fa5 100%);
            color: #e8f1ff;
            -webkit-font-smoothing: antialiased;
            padding: 20px;
            overflow-x: hidden;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUpFromBottom {
            from {
                opacity: 0;
                transform: translateY(60px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-60px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(60px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .page {
            max-width: 1600px;
            margin: 0 auto;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 50%, #4a7ba7 100%);
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            min-height: 90vh;
            opacity: 0;
            animation: fadeIn 0.8s ease forwards;
            animation-delay: 0.3s;
        }

        header.topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.8) 0%, rgba(26, 38, 66, 0.9) 100%);
            gap: 20px;
            border-bottom: 1px solid rgba(107, 141, 214, 0.3);
            backdrop-filter: blur(15px);
        }

        .logo {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .logo .title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #d4a574 0%, #f5e6d3 50%, #d4a574 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            animation: shimmer 3s infinite;
            background-size: 200% 200%;
        }

        @keyframes shimmer {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .logo .sub {
            font-family: 'Cormorant Garamond';
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 6px;
            color: #a8c5e0;
            text-transform: lowercase;
            font-style: italic;
            margin-top: -5px;
        }

        nav.topnav {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(26, 38, 66, 0.9);
            backdrop-filter: blur(15px);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid rgba(107, 141, 214, 0.3);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6), 0 0 20px rgba(107, 141, 214, 0.2);
        }

        .topnav a {
            text-decoration: none;
            color: #e8f1ff;
            padding: 8px 18px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border-radius: 25px;
            position: relative;
        }

        .topnav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #8bbdf7;
            transform: translateX(-50%);
            transition: width 0.3s ease;
        }

        .topnav a:hover {
            background: rgba(107, 141, 214, 0.2);
            color: #8bbdf7;
            transform: translateY(-2px);
        }

        .topnav a:hover::after {
            width: 60%;
        }

        .cart-wrap {
            position: relative;
            display: flex;
            align-items: center;
        }

        .cart-btn {
            background: linear-gradient(135deg, #3d5a99, #2d4a7c);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid rgba(107, 141, 214, 0.4);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .cart-btn:hover {
            background: linear-gradient(135deg, #4d6fb3, #3d5a99);
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 0 25px rgba(107, 141, 214, 0.6);
        }

        .cart-badge {
            position: absolute;
            right: -8px;
            top: -8px;
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            padding: 4px 8px;
            border-radius: 999px;
            font-size: 12px;
            min-width: 22px;
            text-align: center;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.6);
        }

        .main {
            display: flex;
            gap: 20px;
            padding: 24px;
            position: relative;
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.6), rgba(45, 90, 123, 0.4));
            align-items: flex-start;
        }

        .left-filter {
            width: 280px;
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.7), rgba(26, 38, 66, 0.9));
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(107, 141, 214, 0.2);
            transition: all 0.35s ease;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            opacity: 0;
            animation: slideInFromLeft 0.8s ease forwards;
        }

        .filter-section h4 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #8bbdf7;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .category-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px;
        }

        .category-btn,
        .brand-btn {
            background: transparent;
            border: 1px solid rgba(107, 141, 214, 0.25);
            color: #e8f1ff;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
        }

        .category-btn:hover,
        .brand-btn:hover {
            background: rgba(107, 141, 214, 0.15);
            transform: translateX(4px);
            border-color: #8bbdf7;
        }

        .brand-btn {
            padding: 8px 12px;
            border-radius: 10px;
            background: rgba(30, 58, 95, 0.4);
            font-size: 0.95rem;
        }

        .brand-btn:hover {
            transform: translateY(-2px);
        }

        .category-btn.active,
        .brand-btn.active {
            background: linear-gradient(90deg, #3d5a99, #4d6fb3);
            color: white;
            border: none;
            box-shadow: 0 6px 20px rgba(107, 141, 214, 0.4);
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.8), rgba(26, 38, 66, 0.9));
            padding: 16px 20px;
            border-radius: 16px;
            border: 1px solid rgba(107, 141, 214, 0.2);
            flex-wrap: wrap;
        }

        .controls-left {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .controls> :last-child {
            opacity: 0;
            animation: slideInFromRight 0.8s ease forwards;
        }

        .filter-open-btn {
            background: rgba(30, 58, 95, 0.6);
            border: 1px solid rgba(107, 141, 214, 0.25);
            padding: 10px 16px;
            border-radius: 12px;
            color: #e8f1ff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
            display: none;
        }

        .filter-open-btn:hover {
            background: rgba(107, 141, 214, 0.2);
            transform: translateY(-2px);
            border-color: #8bbdf7;
        }

        .sort-select {
            background: rgba(45, 90, 123, 0.6);
            border: 1px solid rgba(107, 141, 214, 0.25);
            padding: 10px 14px;
            border-radius: 12px;
            color: #e8f1ff;
            font-family: 'Cormorant Garamond', serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sort-select:hover {
            background: rgba(61, 90, 153, 0.8);
            border-color: #8bbdf7;
        }

        .sort-select option {
            background: #2d4a7c;
            color: #e8f1ff;
        }

        .search-input {
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid rgba(107, 141, 214, 0.25);
            background: rgba(30, 58, 95, 0.6);
            color: #e8f1ff;
            font-size: 1rem;
            width: 220px;
            transition: 0.25s ease;
        }

        .search-input::placeholder {
            color: rgba(232, 241, 255, 0.5);
        }

        .search-input:focus {
            border-color: #8bbdf7;
            background: rgba(30, 58, 95, 0.8);
            outline: none;
            box-shadow: 0 0 20px rgba(107, 141, 214, 0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding-bottom: 40px;
        }

        .card {
            perspective: 2000px;
            opacity: 0;
            animation: slideUpFromBottom 0.6s ease forwards;
        }

        .card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 380px;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
        }

        .card-inner.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            inset: 0;
            border-radius: 16px;
            overflow: hidden;
            backface-visibility: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .card-face:hover {
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(139, 189, 247, 0.3);
        }

        .card-front {
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.9), rgba(26, 38, 66, 0.95));
            border: 1px solid rgba(107, 141, 214, 0.2);
        }

        .card-image {
            height: 180px;
            background: rgba(26, 35, 50, 0.8);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: fill;
        }

        .card-body {
            padding: 14px 18px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex: 1;
        }

        .card-title {
            font-weight: 700;
            color: #e8f1ff;
            font-size: 1.1rem;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-meta {
            color: #a8c5e0;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .card-rating-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            margin-bottom: 6px;
        }

        .stars {
            color: #FFD700;
            letter-spacing: 1px;
        }

        .review-count {
            color: #8bbdf7;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .sold-badge {
            background: rgba(139, 189, 247, 0.1);
            color: #a8c5e0;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(139, 189, 247, 0.2);
            display: inline-block;
        }

        .card-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-top: auto;
        }

        .add-btn,
        .more-btn {
            border: none;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
        }

        .add-btn {
            background: linear-gradient(135deg, #8bbdf7, #6ba7e6);
            color: #0e223d;
            box-shadow: 0 4px 15px rgba(139, 189, 247, 0.3);
        }

        .more-btn {
            background: transparent;
            border: 1px solid rgba(107, 141, 214, 0.3);
            color: #e8f1ff;
            font-size: 0.95rem;
        }

        .more-btn:hover {
            background: rgba(107, 141, 214, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
            border-color: #8bbdf7;
        }

        .add-btn:hover {
            filter: brightness(1.2);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 189, 247, 0.5);
        }

        .info-btn {
            position: absolute;
            left: 12px;
            top: 12px;
            background: rgba(30, 58, 95, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(107, 141, 214, 0.4);
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 5;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .info-btn:hover {
            background: rgba(107, 141, 214, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(139, 189, 247, 0.5);
        }

        .card-back {
            transform: rotateY(180deg);
            padding: 20px;
            background: linear-gradient(145deg, rgba(30, 58, 95, 0.98), rgba(26, 38, 66, 0.95));
            color: #e8f1ff;
            border: 1px solid rgba(107, 141, 214, 0.2);
        }

        .back-content {
            font-size: 1rem;
            line-height: 1.5;
            color: #a8c5e0;
            overflow: auto;
            padding-right: 10px;
            max-height: 280px;
        }

        .back-content::-webkit-scrollbar {
            width: 6px;
        }

        .back-content::-webkit-scrollbar-track {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 10px;
        }

        .back-content::-webkit-scrollbar-thumb {
            background: rgba(139, 189, 247, 0.5);
            border-radius: 10px;
        }

        .corner-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            z-index: 12;
            transition: all 0.2s ease;
            color: #8bbdf7;
            font-size: 24px;
            font-weight: bold;
        }

        .corner-icon:hover {
            transform: scale(1.15);
            color: #a8c5e0;
        }

        .cart-sidebar {
            width: 380px;
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.9), rgba(26, 38, 66, 0.95));
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(107, 141, 214, 0.2);
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .cart-sidebar.hidden {
            width: 0;
            padding: 0;
            border: none;
            opacity: 0;
            overflow: hidden;
        }

        .cart-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 16px;
            max-height: 65vh;
            overflow: auto;
            padding-right: 8px;
        }

        .cart-list::-webkit-scrollbar {
            width: 8px;
        }

        .cart-list::-webkit-scrollbar-track {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 10px;
        }

        .cart-list::-webkit-scrollbar-thumb {
            background: rgba(139, 189, 247, 0.5);
            border-radius: 10px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            background: rgba(30, 58, 95, 0.5);
            border-radius: 10px;
        }

        .cart-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .ci-meta {
            flex-grow: 1;
        }

        .ci-actions {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .qty-btn {
            background: rgba(107, 141, 214, 0.3);
            border: none;
            color: #e8f1ff;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .qty-btn:hover {
            background: #8bbdf7;
            color: #1e3a5f;
        }

        .remove-btn {
            background: rgba(255, 71, 87, 0.6);
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: #ff4757;
            transform: scale(1.1);
        }

        .cart-summary {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(107, 141, 214, 0.2);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            color: #e8f1ff;
            font-size: 1.2rem;
        }

        .cart-message {
            padding: 12px 16px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 600;
            animation: slideIn 0.3s ease;
            margin-bottom: 12px;
        }

        .cart-message.success {
            background: linear-gradient(135deg, rgba(46, 213, 115, 0.2), rgba(46, 213, 115, 0.1));
            border: 1px solid rgba(46, 213, 115, 0.3);
            color: #a8e6cf;
        }

        .cart-message.info {
            background: linear-gradient(135deg, rgba(139, 189, 247, 0.2), rgba(139, 189, 247, 0.1));
            border: 1px solid rgba(139, 189, 247, 0.3);
            color: #8bbdf7;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filter-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 50;
            line-height: 1;
            display: none;
            transition: background 0.2s;
        }

        .filter-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .filter-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 39;
            display: none;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .filter-overlay.active {
            display: block;
            opacity: 1;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 1000px) {
            .filter-open-btn {
                display: block;
            }

            .main {
                gap: 0;
                padding: 24px;
            }

            .left-filter {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                width: 300px;
                max-width: 80%;
                z-index: 40;
                transform: translateX(-100%);
                transition: transform 0.35s ease, opacity 0.35s ease;
                padding: 60px 20px 20px;
                overflow-y: auto;
                background: linear-gradient(180deg, rgba(30, 58, 95, 0.98), rgba(26, 38, 66, 0.98));
                border-radius: 0 16px 16px 0;
                box-shadow: 10px 0 30px rgba(0, 0, 0, 0.8);
                opacity: 1;
                animation: none;
            }

            .left-filter.active {
                transform: translateX(0);
            }

            .filter-close-btn {
                display: block;
            }

            .cart-sidebar {
                position: fixed;
                right: 12px;
                top: 100px;
                z-index: 30;
                width: 340px;
                transform: translateX(0);
                height: auto;
                max-height: 85vh;
            }

            .cart-sidebar.hidden {
                transform: translateX(110%);
                width: 340px;
                opacity: 1;
            }
        }

        @media (max-width: 680px) {
            body {
                padding: 10px;
            }

            header.topbar {
                flex-direction: column;
                align-items: center;
                gap: 16px;
                padding: 20px;
            }

            nav.topnav {
                flex-wrap: wrap;
                justify-content: center;
                padding: 8px 10px;
            }

            .main {
                padding: 16px 8px;
            }

            .logo .title {
                font-size: 1.5rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls-left {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .controls .filter-open-btn,
            .controls .sort-select,
            .controls .search-input {
                width: 100%;
            }

            .grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .card-inner {
                height: 340px;
            }

            .cart-sidebar {
                width: 96%;
                right: 2%;
                top: 10px;
                height: 95vh;
                max-height: 95vh;
            }

            .cart-list {
                max-height: 70vh;
            }
        }
    </style>
</head>

<body>
    <div class="page">
        <header class="topbar">
            <div class="logo">
                <div>
                    <div class="title">ARTISAN</div>
                    <div class="sub">essentials</div>
                </div>
            </div>
            <nav class="topnav">
                <a href="home.html">Home</a>
                <a href="#" style="color:#d4a574;font-weight:700">Shop</a>
                <a href="updateabout.html">About</a>
                <a href="updatecontact.html">Contact</a>
            </nav>
            <div class="cart-wrap">
                <div class="cart-badge" id="cartBadge">0</div>
                <button class="cart-btn" id="cartBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="#e8f1ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="8" cy="21" r="1" />
                        <circle cx="19" cy="21" r="1" />
                        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.72a2 2 0 0 0 2-1.58L23 6H6" />
                    </svg>
                </button>
            </div>
        </header>

        <div class="main" id="mainArea">
            <div class="filter-overlay" id="filterOverlay"></div>
            <aside class="left-filter" id="leftFilter">
                <button id="closeFilter" class="filter-close-btn">×</button>
                <div class="filter-section">
                    <h4>Category</h4>
                    <div class="category-list" id="categoryList"></div>
                </div>
                <hr style="margin:20px 0;border-color:rgba(107,141,214,0.2)">
                <div class="filter-section">
                    <h4>Brand</h4>
                    <div class="category-list" id="brandList" style="flex-direction: row; flex-wrap: wrap;"></div>
                </div>
            </aside>

            <div class="content">
                <div class="controls">
                    <div class="controls-left">
                        <button class="filter-open-btn" id="filterOpenBtn">Filter</button>
                        <select class="sort-select" id="sortSelect">
                            <option value="default">Sort By: Default</option>
                            <option value="popularity">Sort By: Popularity</option>
                            <option value="low">Sort By: Price (Low to High)</option>
                            <option value="high">Sort By: Price (High to Low)</option>
                        </select>
                    </div>
                    <input type="search" class="search-input" id="searchInput" placeholder="Search products...">
                </div>

                <div class="grid" id="productGrid"></div>
            </div>

            <aside class="cart-sidebar hidden" id="cartSidebar">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="font-family: 'Cinzel', serif;">Cart</h3>
                    <button id="closeCart" class="filter-open-btn">Close</button>
                </div>
                <div id="cartMessage"></div>
                <div class="cart-list" id="cartList"></div>
                <div class="cart-summary">
                    <div class="total-row">
                        <div>Total</div>
                        <div id="subtotal">$0.00</div>
                    </div>
                    <div style="display:flex;gap:10px">
                        <button id="clearCart" class="more-btn" style="flex:1">Clear</button>
                        <button id="checkout" class="add-btn" style="flex:1">Checkout</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const BRANDS = ["Moleskine", "Leuchtturm1917", "Rhodia", "Pilot", "Faber-Castell", "Staedtler", "Tombow"];
        const CATEGORIES = ["Pens", "Markers", "Notebooks", "Brushes", "Ink", "Accessories", "Paper"];

        // Products with document file paths
        const PRODUCTS = [
            { id: 1, title: "Moleskine Classic Hardcover Notebook", brand: "Moleskine", category: "Notebooks", price: 24.99, img: "item images/images brands/moleskine/moleskine note book.jpg", short: "Iconic Italian hardcover with elastic band.", long: "Moleskine Classic Notebook – The legendary notebook of artists and thinkers. Features ivory-colored paper, elastic closure band, ribbon bookmark, and expandable inner pocket. Perfect for writers, artists, and professionals.", rating: 4.5, reviews: 1200, sold: 5500, docFile: "1.docx" },
            { id: 2, title: "Pilot Premium Pen box", brand: "Pilot", category: "Accessories", price: 12.99, img: "item images/images brands/pilot/pilot accesories.webp", short: "Elegant pen storage box.", long: "Pilot Accessories Set – Premium refills, clips, and pen care essentials. Everything you need to maintain your Pilot writing instruments in perfect condition.", rating: 4.9, reviews: 3200, sold: 8100, docFile: "2.docx" },
            { id: 3, title: "Leuchtturm1917 Bullet Journal", brand: "Leuchtturm1917", category: "Notebooks", price: 29.99, img: "item images/images brands/Leuchtturm1917/Leuchtturm1917 notebook.jpg", short: "Numbered pages bullet journal system.", long: "Leuchtturm1917 Dotted Journal – Premium bullet journal with 249 numbered pages, 8 perforated sheets, gusseted pocket, blank table of contents, and page marker. Ink-proof 80gsm paper.", rating: 4.7, reviews: 1800, sold: 7300, docFile: "3.docx" },
            { id: 4, title: "Faber-Castell Graphite Sketch Set", brand: "Faber-Castell", category: "Pens", price: 34.99, img: "item images/images brands/faber/faber pen.jpg", short: "Professional graphite pencil range.", long: "Faber-Castell Graphite Set – Premium quality graphite pencils ranging from 2H to 8B. Superior break-resistant leads with consistent laydown. Essential for artists and designers.", rating: 4.8, reviews: 920, sold: 4100, docFile: "4.docx" },
            { id: 5, title: "Rhodia Dot Grid Notepad", brand: "Rhodia", category: "Notebooks", price: 18.99, img: "item images/images brands/rhodia/Rhodia Notebooks 2.jpg", short: "French dot grid with orange cover.", long: "Rhodia DotPad – Legendary French paper quality with 5mm dot grid. Smooth 80g Clairefontaine paper, microperforated sheets. The orange cover that professionals recognize worldwide.", rating: 4.6, reviews: 5400, sold: 15000, docFile: "5.docx" },
            { id: 6, title: "Tombow ABT Dual Brush Pen Set", brand: "Tombow", category: "Markers", price: 45.99, img: "item images/images brands/tombow/tombow marker.jpg", short: "Dual-tip blendable art markers.", long: "Tombow Dual Brush Markers – Water-based ink markers with flexible brush tip and fine tip. Blendable, odorless, and perfect for hand lettering, manga, illustrations, and mixed media art.", rating: 4.9, reviews: 3400, sold: 12000, docFile: "6.docx" },
            { id: 7, title: "Staedtler Triplus Fineliner Set", brand: "Staedtler", category: "Pens", price: 22.99, img: "item images/images brands/steadler/Staedtler pen.webp", short: "Triangular 0.3mm fineliner pens.", long: "Staedtler Triplus Fineliner – German-engineered superfine 0.3mm metal-clad tip. Ergonomic triangular barrel prevents hand fatigue. DRY SAFE technology allows days uncapped without drying.", rating: 4.6, reviews: 1100, sold: 6700, docFile: "7.docx" },
            { id: 8, title: "Moleskine Premium Pen", brand: "Moleskine", category: "Pens", price: 32.99, img: "item images/images brands/moleskine/Moleskine Pens 7.webp", short: "Italian-designed premium writing pen.", long: "Moleskine Art Sketchbook – 165gsm heavy-weight, acid-free paper suitable for pencil, charcoal, and light wet media. Hard cover protection with thread-bound binding that lies flat.", rating: 4.1, reviews: 230, sold: 890, docFile: "8.docx" },
            { id: 9, title: "Pilot Iroshizuku Blue Ink Bottle", brand: "Pilot", category: "Ink", price: 38.99, img: "item images/images brands/pilot/pilot blue ink.jpg", short: "50ml blue fountain pen ink.", long: "Pilot Iroshizuku Ink – 'Dew on Leaves' collection. Smooth-flowing fountain pen ink in stunning blue shade. 50ml bottle with built-in ink reservoir for easy filling.", rating: 4.8, reviews: 780, sold: 2900, docFile: "9.docx" },
            { id: 10, title: "Leuchtturm1917 Graphite Leads", brand: "Leuchtturm1917", category: "Accessories", price: 8.99, img: "item images/images brands/Leuchtturm1917/Leuchtturm1917  accesaries.jpg", short: "Premium replacement graphite leads.", long: "Leuchtturm1917 Pen Loop – Self-adhesive elastic pen holder that attaches to any notebook. Fits most pen sizes. Available in multiple colors to match your notebook.", rating: 4.7, reviews: 1500, sold: 6200, docFile: "10.docx" },
            { id: 11, title: "Faber-Castell Watercolor Brush Set", brand: "Faber-Castell", category: "Markers", price: 42.99, img: "item images/images brands/faber/faber marker.jpg", short: "Professional watercolor brushes.", long: "Faber-Castell Art Brushes – Professional-grade synthetic bristles for watercolor and acrylic. Includes round, flat, and filbert brushes. Spring-tempered handles with seamless ferrules.", rating: 4.4, reviews: 450, sold: 3100, docFile: "11.docx" },
            { id: 12, title: "Rhodia Webnotebook A5", brand: "Rhodia", category: "Notebooks", price: 26.99, img: "item images/images brands/rhodia/rhodia note book.webp", short: "A5 leatherette bound journal.", long: "Rhodia Webnotebook – Premium bound journal with Italian leatherette cover. Contains 192 pages of 90g Clairefontaine paper. Features elastic closure, ribbon marker, and inner pocket.", rating: 4.8, reviews: 780, sold: 2100, docFile: "12.docx" },
            { id: 13, title: "Tombow Mono Zero Precision Eraser", brand: "Tombow", category: "Accessories", price: 5.99, img: "item images/images brands/tombow/tombow accesaries 1.jpg", short: "Pin-point precision eraser.", long: "Tombow Mono Eraser – Japan's legendary non-abrasive eraser. Removes graphite cleanly without tearing or ghosting. Minimal residue and long-lasting performance.", rating: 4.9, reviews: 1500, sold: 5600, docFile: "13.docx" },
            { id: 14, title: "Staedtler Pigment Liner Set", brand: "Staedtler", category: "Pens", price: 19.99, img: "item images/images brands/steadler/staedtler pen set.webp", short: "Waterproof pigment liner collection.", long: "Staedtler Pigment Liners – Waterproof, lightfast pigment ink for permanent results. Multiple tip sizes from 0.05mm to 0.8mm. Ideal for illustrations, journaling, and technical work.", rating: 4.7, reviews: 890, sold: 3400, docFile: "14.docx" },
            { id: 15, title: "Moleskine Leather Business card holder", brand: "Moleskine", category: "Accessories", price: 35.99, img: "item images/images brands/moleskine/moleskine accesioray.jpg", short: "Italian leather card holder.", long: "Moleskine Pen Case – Crafted from genuine Italian leather with elastic closure. Elegant storage for up to 3 writing instruments. Compact size fits in bags and pockets.", rating: 4.2, reviews: 150, sold: 420, docFile: "m15.docx" },
            { id: 16, title: "Pilot Iroshizuku Black Ink Bottle", brand: "Pilot", category: "Ink", price: 28.99, img: "item images/images brands/pilot/pilot black ink.webp", short: "Bamboo charcoal black ink 50ml.", long: "Pilot Iroshizuku Ink – 'Take-sumi' bamboo charcoal black. Deep, rich black with subtle undertones. Smooth flow and quick-drying formula in elegant 50ml glass bottle.", rating: 4.7, reviews: 560, sold: 2100, docFile: "m16.docx" },
            { id: 17, title: "Leuchtturm1917 Premium ball pen", brand: "Leuchtturm1917", category: "Pens", price: 39.99, img: "item images/images brands/Leuchtturm1917/Leuchtturm1917 Markers 1.jpg", short: "German-engineered ballpoint pen.", long: "Leuchtturm1917 Master – A4+ format (225 x 315mm) with 233 numbered pages. Includes index, 8 perforated sheets, page marker, and gusseted pocket. Perfect for architects and designers.", rating: 4.5, reviews: 320, sold: 1800, docFile: "17.docx" },
            { id: 18, title: "Faber-Castell Creative Studio Set", brand: "Faber-Castell", category: "Accessories", price: 52.99, img: "item images/images brands/faber/faber accesarioes.jpg", short: "Complete art accessory kit.", long: "Faber-Castell Studio Set – Comprehensive art supplies including erasers, sharpeners, blending stumps, and rulers. Professional-grade tools in elegant storage tin.", rating: 4.6, reviews: 320, sold: 1800, docFile: "18.docx" },
            { id: 19, title: "Rhodia Meeting Pad A5+", brand: "Rhodia", category: "Notebooks", price: 22.99, img: "item images/images brands/rhodia/rhodia notebook 1.jpg", short: "Pre-printed meeting notepad.", long: "Rhodia Meeting Book – Pre-printed pages with date fields, attendees list, action items, and notes section. Perforated for easy sharing. Premium Clairefontaine paper.", rating: 4.6, reviews: 320, sold: 1800, docFile: "19.docx" },
            { id: 20, title: "Tombow Fudenosuke Brush Pen", brand: "Tombow", category: "Brushes", price: 14.99, img: "item images/images brands/tombow/tombow brush.jpg", short: "Flexible calligraphy brush pen.", long: "Tombow Fudenosuke – Flexible yet firm brush tip perfect for modern calligraphy and hand lettering. Water-based pigment ink. Available in hard and soft tip variants.", rating: 4.8, reviews: 2600, sold: 9800, docFile: "20.docx" },
            { id: 21, title: "Faber-Castell Artist Pen", brand: "Faber-Castell", category: "Pens", price: 9.99, img: "item images/images brands/faber/download.jpg", short: "Professional fine art pen.", long: "Faber-Castell Grip – Ergonomic triangular shape with patented Soft-Grip zone. Break-resistant leads in multiple grades. Perfect for extended writing and drawing sessions.", rating: 4.4, reviews: 540, sold: 2800, docFile: "21.docx" },
            { id: 22, title: "Pilot Planner Notebook", brand: "Pilot", category: "Notebooks", price: 31.99, img: "item images/images brands/pilot/pilot notebook.webp", short: "Weekly layout planner system.", long: "Pilot Weekly Planner – Functional weekly layout with time blocks, to-do lists, and notes sections. High-quality paper suitable for all pen types. Compact yet spacious design.", rating: 4.5, reviews: 190, sold: 670, docFile: "22.docx" },
            { id: 23, title: "Pilot Calligraphy Brush Pen", brand: "Pilot", category: "Brushes", price: 16.99, img: "item images/images brands/pilot/Pilot Brushes 3.jpg", short: "Refillable calligraphy brush.", long: "Pilot Brush Pen – Authentic brush calligraphy experience with modern convenience. Refillable cartridge system. Flexible synthetic bristles respond like traditional brushes.", rating: 4.7, reviews: 430, sold: 1500, docFile: "23.docx" },
            { id: 24, title: "Leuchtturm1917 Pencil Loop", brand: "Leuchtturm1917", category: "Accessories", price: 7.99, img: "item images/images brands/Leuchtturm1917/Leuchtturm1917 accescaries.webp", short: "Self-adhesive pencil holder.", long: "Leuchtturm1917 Bookmark Set – Elegant metal bookmarks with magnetic closure. Ultra-thin design won't damage pages. Set of 3 in coordinating colors.", rating: 4.3, reviews: 210, sold: 850, docFile: "24.docx" },
            { id: 25, title: "Faber-Castell Art Notebook A4", brand: "Faber-Castell", category: "Notebooks", price: 36.99, img: "item images/images brands/faber/faber notebook.webp", short: "A4 mixed media spiral notebook.", long: "Faber-Castell Art Notebook – 200gsm heavyweight paper suitable for wet and dry media. Spiral-bound for easy page-turning. Acid-free archival quality paper.", rating: 4.2, reviews: 150, sold: 420, docFile: "25.docx" },
            { id: 26, title: "Faber-Castell Sketch Pad A5", brand: "Faber-Castell", category: "Notebooks", price: 12.99, img: "item images/images brands/faber/faber notebook2.webp", short: "A5 spiral-bound sketch pad.", long: "Faber-Castell Sketch Pad – 120gsm fine-grain paper ideal for pencil, charcoal, and ink. Spiral-bound with micro-perforated sheets. Sturdy backing board.", rating: 4.5, reviews: 250, sold: 1200, docFile: "26.docx" },
            { id: 27, title: "Tombow Mono Air Touch Tape", brand: "Tombow", category: "Accessories", price: 6.99, img: "item images/images brands/tombow/tombow accesaries.webp", short: "Refillable correction tape.", long: "Tombow Correction Tape – Instant, clean corrections with ergonomic design. Smooth application with no dry time needed. Compact refillable dispenser.", rating: 4.7, reviews: 890, sold: 5200, docFile: "27.docx" },
            { id: 28, title: "Tombow Mixed Media Paper Pad", brand: "Tombow", category: "Paper", price: 27.99, img: "item images/images brands/tombow/tombow paper.webp", short: "250gsm heavyweight paper pad.", long: "Tombow Paper Pad – 250gsm heavyweight paper designed for markers, watercolors, and mixed media. Minimal bleed-through. Cold-press texture.", rating: 4.9, reviews: 560, sold: 2200, docFile: "28.docx" },
            { id: 29, title: "Pilot Pocket Brush Pen", brand: "Pilot", category: "Brushes", price: 14.99, img: "item images/images brands/pilot/pilot brushes.jpg", short: "Compact portable brush pen.", long: "Pilot Pocket Brush – Compact brush pen with protective cap. Authentic brush feel with modern convenience. Refillable ink cartridge system.", rating: 4.6, reviews: 340, sold: 1300, docFile: "29.docx" },
            { id: 30, title: "Pilot Juice Gel Ink Pens", brand: "Pilot", category: "Markers", price: 11.99, img: "item images/images brands/pilot/pilot marker 1.jpg", short: "0.5mm gel pens in vivid colors.", long: "Pilot Juice – Ultra-smooth 0.5mm gel ink in brilliant colors. Quick-drying, fade-resistant formula. Comfortable rubber grip for extended writing.", rating: 4.7, reviews: 1100, sold: 4800, docFile: "30.docx" },
            { id: 31, title: "Leuchtturm1917 Pen loop", brand: "Leuchtturm1917", category: "Accessories", price: 21.99, img: "item images/images brands/Leuchtturm1917/Leuchtturm1917 pen.webp", short: "Elastic pen holder accessory.", long: "Leuchtturm1917 Soft Cover – All the quality features of the hardcover in a flexible format. Numbered pages, table of contents, and premium 80gsm paper. Perfect for travel.", rating: 4.5, reviews: 280, sold: 1600, docFile: "31.docx" }
        ];

        const state = {
            allProducts: PRODUCTS,
            filteredProducts: PRODUCTS,
            filterCategory: null,
            filterBrand: null,
            searchTerm: '',
            sort: 'default',
            cart: {}
        };

        const els = {
            mainArea: document.getElementById('mainArea'),
            productGrid: document.getElementById('productGrid'),
            categoryList: document.getElementById('categoryList'),
            brandList: document.getElementById('brandList'),
            searchInput: document.getElementById('searchInput'),
            sortSelect: document.getElementById('sortSelect'),
            cartBtn: document.getElementById('cartBtn'),
            cartSidebar: document.getElementById('cartSidebar'),
            cartList: document.getElementById('cartList'),
            cartBadge: document.getElementById('cartBadge'),
            subtotal: document.getElementById('subtotal'),
            cartMessage: document.getElementById('cartMessage'),
            leftFilter: document.getElementById('leftFilter'),
            filterOpenBtn: document.getElementById('filterOpenBtn'),
            closeFilterBtn: document.getElementById('closeFilter'),
            filterOverlay: document.getElementById('filterOverlay')
        };

        // Modified Details Button Handler - Direct download/open
        function openModal(product) {
            // Create a temporary link and trigger download/open
            const link = document.createElement('a');
            link.href = product.docFile;
            link.target = '_blank'; // Open in new tab
            link.rel = 'noopener noreferrer';

            // Try to open directly in new tab
            // The browser will either open it (if it can display .docx) or download it
            link.click();

            // Also show a message in cart
            showCartMessage(`Opening ${product.title} documentation...`, 'info');
        }

        // --- FILTER & SORT LOGIC ---
        function renderFilters() {
            els.categoryList.innerHTML = '';
            const allCatBtn = document.createElement('button');
            allCatBtn.className = 'category-btn' + (state.filterCategory === null ? ' active' : '');
            allCatBtn.textContent = 'All Categories';
            allCatBtn.onclick = () => { state.filterCategory = null; applyFilters(); };
            els.categoryList.appendChild(allCatBtn);
            CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn' + (state.filterCategory === cat ? ' active' : '');
                btn.textContent = cat;
                btn.onclick = () => { state.filterCategory = (state.filterCategory === cat ? null : cat); applyFilters(); };
                els.categoryList.appendChild(btn);
            });

            els.brandList.innerHTML = '';
            BRANDS.forEach(brand => {
                const btn = document.createElement('button');
                btn.className = 'brand-btn' + (state.filterBrand === brand ? ' active' : '');
                btn.textContent = brand;
                btn.onclick = () => { state.filterBrand = (state.filterBrand === brand ? null : brand); applyFilters(); };
                els.brandList.appendChild(btn);
            });

            els.leftFilter.classList.remove('active');
            els.filterOverlay.classList.remove('active');
        }

        function applyFilters() {
            let arr = [...state.allProducts];
            if (state.searchTerm) {
                const term = state.searchTerm.toLowerCase();
                arr = arr.filter(p => p.title.toLowerCase().includes(term) || p.brand.toLowerCase().includes(term) || p.category.toLowerCase().includes(term));
            }
            if (state.filterCategory) arr = arr.filter(p => p.category === state.filterCategory);
            if (state.filterBrand) arr = arr.filter(p => p.brand === state.filterBrand);
            if (state.sort === 'low') arr.sort((a, b) => a.price - b.price);
            else if (state.sort === 'high') arr.sort((a, b) => b.price - a.price);
            else if (state.sort === 'popularity') arr.sort((a, b) => b.sold - a.sold);
            else arr.sort((a, b) => a.id - b.id);

            state.filteredProducts = arr;
            renderProducts();
            renderFilters();
        }

        function getStarHTML(rating) {
            const fullStars = Math.round(rating);
            let stars = '';
            for (let i = 0; i < 5; i++) {
                stars += i < fullStars ? '★' : '☆';
            }
            return stars;
        }

        function createCard(product) {
            const card = document.createElement('div');
            card.className = 'card';
            const index = state.filteredProducts.findIndex(p => p.id === product.id);
            card.style.animationDelay = `${(index % 9) * 0.1 + 0.1}s`;

            const inner = document.createElement('div');
            inner.className = 'card-inner';

            const front = document.createElement('div');
            front.className = 'card-face card-front';

            const infoBtn = document.createElement('button');
            infoBtn.className = 'info-btn';
            infoBtn.textContent = 'i';
            infoBtn.onclick = (e) => {
                e.stopPropagation();
                inner.classList.toggle('flipped');
            };

            const imgWrap = document.createElement('div');
            imgWrap.className = 'card-image';
            const img = document.createElement('img');
            img.src = product.img;
            img.alt = product.title;
            img.onerror = function () { this.src = 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=500'; };

            const body = document.createElement('div');
            body.className = 'card-body';

            const title = document.createElement('div');
            title.className = 'card-title';
            title.textContent = product.title;

            const meta = document.createElement('div');
            meta.className = 'card-meta';
            meta.textContent = `${product.brand} | ${product.category}`;

            const ratingRow = document.createElement('div');
            ratingRow.className = 'card-rating-row';
            const starSpan = document.createElement('span');
            starSpan.className = 'stars';
            starSpan.textContent = getStarHTML(product.rating);
            const reviewSpan = document.createElement('span');
            reviewSpan.className = 'review-count';
            reviewSpan.textContent = `(${product.reviews})`;
            const soldBadge = document.createElement('span');
            soldBadge.className = 'sold-badge';
            soldBadge.textContent = `${product.sold} sold`;

            ratingRow.appendChild(starSpan);
            ratingRow.appendChild(reviewSpan);
            ratingRow.appendChild(document.createTextNode('\u00A0'));
            ratingRow.appendChild(soldBadge);

            const bottom = document.createElement('div');
            bottom.className = 'card-bottom';
            const price = document.createElement('div');
            price.style.cssText = 'font-weight:900;font-size:1.2rem;color:#e8f1ff';
            price.textContent = `$${product.price.toFixed(2)}`;
            const actions = document.createElement('div');
            actions.style.cssText = 'display:flex;gap:10px;align-items:center';

            const moreBtn = document.createElement('button');
            moreBtn.className = 'more-btn';
            moreBtn.textContent = 'Details';
            moreBtn.onclick = (e) => {
                e.stopPropagation();
                openModal(product);
            };

            const addBtn = document.createElement('button');
            addBtn.className = 'add-btn';
            addBtn.textContent = 'Add';
            addBtn.onclick = (e) => {
                e.stopPropagation();
                addToCart(product.id);
            };

            const back = document.createElement('div');
            back.className = 'card-face card-back';

            const backTitle = document.createElement('div');
            backTitle.style.cssText = 'font-weight:900;margin-bottom:10px;font-size:1.1rem';
            backTitle.textContent = product.title;

            const backMeta = document.createElement('div');
            backMeta.style.cssText = 'color:#a8c5e0;margin-bottom:10px';
            backMeta.textContent = `${product.brand} • ${product.category} • $${product.price.toFixed(2)}`;

            const desc = document.createElement('div');
            desc.className = 'back-content';
            desc.textContent = product.long;

            const backIcon = document.createElement('div');
            backIcon.className = 'corner-icon';
            backIcon.textContent = '↩';
            backIcon.onclick = (e) => {
                e.stopPropagation();
                inner.classList.toggle('flipped');
            };

            imgWrap.appendChild(img);
            front.appendChild(imgWrap);
            front.appendChild(infoBtn);

            actions.appendChild(moreBtn);
            actions.appendChild(addBtn);
            bottom.appendChild(price);
            bottom.appendChild(actions);

            body.appendChild(title);
            body.appendChild(meta);
            body.appendChild(ratingRow);
            body.appendChild(bottom);
            front.appendChild(body);

            back.appendChild(backTitle);
            back.appendChild(backMeta);
            back.appendChild(desc);
            back.appendChild(backIcon);

            inner.appendChild(front);
            inner.appendChild(back);
            card.appendChild(inner);
            return card;
        }

        function renderProducts() {
            els.productGrid.innerHTML = '';
            state.filteredProducts.forEach(product => {
                els.productGrid.appendChild(createCard(product));
            });
        }

        // --- CART LOGIC ---
        function findProduct(id) {
            return state.allProducts.find(p => p.id === id);
        }

        function saveCart() {
            localStorage.setItem('artisanEssentialsCart', JSON.stringify(state.cart));
        }

        function loadCart() {
            const savedCart = localStorage.getItem('artisanEssentialsCart');
            if (savedCart) {
                state.cart = JSON.parse(savedCart);
            }
        }

        function showCartMessage(message, type = 'success') {
            els.cartMessage.innerHTML = `<div class="cart-message ${type}">${message}</div>`;
            setTimeout(() => {
                els.cartMessage.innerHTML = '';
            }, 3000);
        }

        function addToCart(productId) {
            const id = parseInt(productId);
            const product = findProduct(id);
            if (!product) return;

            if (state.cart[id]) {
                state.cart[id].qty++;
                showCartMessage(`${product.title} quantity updated to ${state.cart[id].qty}!`, 'info');
            } else {
                state.cart[id] = { product: product, qty: 1 };
                showCartMessage(`${product.title} added to cart!`, 'success');
            }
            saveCart();
            renderCart();
            els.cartSidebar.classList.remove('hidden');
            els.mainArea.classList.add('cart-open');
        }

        function changeQty(productId, delta) {
            const id = parseInt(productId);
            if (!state.cart[id]) return;

            state.cart[id].qty += delta;

            if (state.cart[id].qty <= 0) {
                delete state.cart[id];
                showCartMessage('Item removed from cart.', 'info');
            } else {
                showCartMessage(`${state.cart[id].product.title} quantity updated.`, 'info');
            }
            saveCart();
            renderCart();
        }

        function createCartItem(item) {
            const wrap = document.createElement('div');
            wrap.className = 'cart-item';
            wrap.id = `cart-item-${item.product.id}`;

            const img = document.createElement('img');
            img.src = item.product.img;
            img.alt = item.product.title;
            img.onerror = function () { this.src = 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=500'; };

            const meta = document.createElement('div');
            meta.className = 'ci-meta';
            meta.innerHTML = `<div style="font-weight:700;margin-bottom:4px">${item.product.title}</div><div style="font-size:0.9rem;color:#a8c5e0">${item.product.brand}</div><div style="font-size:0.95rem;margin-top:8px;font-weight:600">$${(item.product.price * item.qty).toFixed(2)} <span style="font-weight:400;color:#a8c5e0">(${item.qty} × $${item.product.price.toFixed(2)})</span></div>`;

            const actions = document.createElement('div');
            actions.className = 'ci-actions';

            const minusBtn = document.createElement('button');
            minusBtn.className = 'qty-btn';
            minusBtn.textContent = '-';
            minusBtn.onclick = () => changeQty(item.product.id, -1);

            const plusBtn = document.createElement('button');
            plusBtn.className = 'qty-btn';
            plusBtn.textContent = '+';
            plusBtn.onclick = () => changeQty(item.product.id, 1);

            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = '×';
            removeBtn.onclick = () => changeQty(item.product.id, -item.qty);

            actions.appendChild(minusBtn);
            actions.appendChild(plusBtn);
            actions.appendChild(removeBtn);

            wrap.appendChild(img);
            wrap.appendChild(meta);
            wrap.appendChild(actions);

            return wrap;
        }

        function renderCart() {
            els.cartList.innerHTML = '';
            let total = 0;
            let totalQty = 0;

            const cartItems = Object.values(state.cart);

            if (cartItems.length === 0) {
                els.cartList.innerHTML = `<p style="text-align:center;color:#a8c5e0;margin-top:20px;">Your cart is empty.</p>`;
            } else {
                cartItems.forEach(item => {
                    els.cartList.appendChild(createCartItem(item));
                    total += item.product.price * item.qty;
                    totalQty += item.qty;
                });
            }

            els.subtotal.textContent = `$${total.toFixed(2)}`;
            els.cartBadge.textContent = totalQty;
        }

        // --- EVENT LISTENERS ---
        els.cartBtn.addEventListener('click', () => {
            els.cartSidebar.classList.toggle('hidden');
            els.mainArea.classList.toggle('cart-open');
            els.leftFilter.classList.remove('active');
            els.filterOverlay.classList.remove('active');
        });

        document.getElementById('closeCart').addEventListener('click', () => {
            els.cartSidebar.classList.add('hidden');
            els.mainArea.classList.remove('cart-open');
        });

        els.searchInput.addEventListener('input', (e) => {
            state.searchTerm = e.target.value;
            applyFilters();
        });

        document.getElementById('clearCart').addEventListener('click', () => {
            if (Object.keys(state.cart).length === 0) {
                showCartMessage('Cart is already empty!', 'info');
                return;
            }
            state.cart = {};
            saveCart();
            renderCart();
            showCartMessage('Cart cleared successfully!', 'success');
        });

        document.getElementById('checkout').addEventListener('click', () => {
            if (Object.keys(state.cart).length === 0) {
                showCartMessage('Your cart is empty!', 'info');
                return;
            }
            showCartMessage('Checkout coming soon! Total: ' + els.subtotal.textContent, 'info');
        });

        document.getElementById('sortSelect').addEventListener('change', (e) => {
            state.sort = e.target.value;
            applyFilters();
        });

        if (els.filterOpenBtn) {
            els.filterOpenBtn.addEventListener('click', () => {
                els.leftFilter.classList.add('active');
                els.filterOverlay.classList.add('active');
                els.cartSidebar.classList.add('hidden');
                els.mainArea.classList.remove('cart-open');
            });
        }

        if (els.closeFilterBtn) {
            els.closeFilterBtn.addEventListener('click', () => {
                els.leftFilter.classList.remove('active');
                els.filterOverlay.classList.remove('active');
            });
        }

        if (els.filterOverlay) {
            els.filterOverlay.addEventListener('click', () => {
                els.leftFilter.classList.remove('active');
                els.filterOverlay.classList.remove('active');
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDocumentViewer();
                els.cartSidebar.classList.add('hidden');
                els.mainArea.classList.remove('cart-open');
                els.leftFilter.classList.remove('active');
                els.filterOverlay.classList.remove('active');
            }
        });

        // --- INITIALIZATION ---
        loadCart();
        applyFilters();
        renderCart();
    </script>
</body>

</html>